(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n})=>{const r=Q(),s=r.querySelector(".card__like-button"),l=r.querySelector(".card__control-button_type_delete"),a=r.querySelector(".card__image");return a.src=e.link,a.alt=e.name,r.querySelector(".card__title").textContent=e.name,o&&s.addEventListener("click",()=>o(s)),n&&l.addEventListener("click",()=>n(r)),t&&a.addEventListener("click",()=>t({name:e.name,link:e.link})),r},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&_(e)})},W=(e,t)=>{e.classList.add(t),e.setAttribute("disabled",!0)},Y=(e,t)=>{e.classList.remove(t),e.removeAttribute("disabled")},Z=e=>e.some(t=>!t.validity.valid),P=(e,t,o)=>{Z(e)?W(t,o):Y(t,o)},ee=(e,t,o,n,r)=>{const s=e.querySelector(`#${t.id}-error`);t.classList.add(o),s.textContent=n,s.classList.add(r)},V=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o),r.textContent="",r.classList.remove(n)},te=(e,t,o,n)=>{if(t.validity.patternMismatch?t.setCustomValidity(t.validity.tooShort?`Поле должно содержать от ${t.getAttribute("minlength")} до ${t.getAttribute("maxlength")} символов.`:t.dataset.errorMessage):t.setCustomValidity(""),!t.validity.valid){ee(e,t,o,t.validationMessage,n);return}V(e,t,o,n)},oe=(e,t,o,n,r,s)=>{const l=Array.from(e.querySelectorAll(t));P(l,r,s),l.forEach(a=>{a.addEventListener("input",()=>{te(e,a,o,n),P(l,r,s)})})},re=e=>{const{formSelector:t,inputSelector:o,submitButtonSelector:n,inactiveButtonClass:r,inputErrorClass:s,errorClass:l}=e;Array.from(document.querySelectorAll(t)).forEach(c=>{const i=c.querySelector(n),p=Array.from(c.querySelectorAll(o));P(p,i,r),oe(c,o,s,l,i,r)})},T=(e,t)=>{const{inputSelector:o,submitButtonSelector:n,inactiveButtonClass:r,inputErrorClass:s,errorClass:l}=t,a=e.querySelector(n),c=Array.from(e.querySelectorAll(o));W(a,r),c.forEach(i=>{V(e,i,s,l)})},u={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2b6cdbdc-b41d-432c-b11b-b1b8da9771c8","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ne=()=>fetch(`${u.baseUrl}/users/me`,{headers:u.headers}).then(m),j=()=>fetch(`${u.baseUrl}/cards`,{headers:u.headers}).then(m),se=({name:e,about:t})=>fetch(`${u.baseUrl}/users/me`,{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:t})}).then(m),ce=({avatar:e})=>fetch(`${u.baseUrl}/users/me/avatar`,{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then(m),le=({name:e,link:t})=>fetch(`${u.baseUrl}/cards`,{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:t})}).then(m),ie=e=>fetch(`${u.baseUrl}/cards/${e}`,{method:"DELETE",headers:u.headers}).then(m),ae=(e,t)=>fetch(`${u.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:u.headers}).then(o=>m(o)),q=document.querySelector(".popup_type_info"),ue=q.querySelector(".popup__title"),F=q.querySelector(".popup__info"),U=q.querySelector(".popup__list"),pe=document.querySelector("#popup-info-definition-template").content,de=document.querySelector("#popup-info-user-preview-template").content,_e=document.querySelector(".header__logo"),H=document.querySelector(".places__list"),A=document.querySelector(".popup_type_edit"),S=A.querySelector(".popup__form"),J=S.querySelector(".popup__input_type_name"),z=S.querySelector(".popup__input_type_description"),w=document.querySelector(".popup_type_new-card"),f=w.querySelector(".popup__form"),me=f.querySelector(".popup__input_type_card-name"),fe=f.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_remove-card"),v=x.querySelector(".popup__form"),C=f.querySelector(".popup__button"),B=document.querySelector(".popup_type_image"),N=B.querySelector(".popup__image"),ye=B.querySelector(".popup__caption"),he=document.querySelector(".profile__edit-button"),Se=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),$=document.querySelector(".profile__image"),k=S.querySelector(".popup__button"),b=document.querySelector(".popup_type_edit-avatar"),h=b.querySelector(".popup__form"),ve=h.querySelector(".popup__input"),E=h.querySelector(".popup__button"),g=function(e,t){e.querySelector(".card__like-count").textContent=t},d=function(e,t){e.textContent=t},L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};re(L);const K=({name:e,link:t})=>{N.src=t,N.alt=e,ye.textContent=e,y(B)},be=e=>{e.preventDefault(),d(k,"Сохранение..."),se({name:J.value,about:z.value}).then(t=>{I.textContent=t.name,d(k,"Сохранить"),M.textContent=t.about,_(A)}).catch(t=>{d(k,"Сохранить"),console.log(t)})},ge=e=>{e.preventDefault(),d(E,"Сохранение..."),ce({avatar:ve.value}).then(t=>{$.style.backgroundImage=`url(${t.avatar})`,d(E,"Сохранить"),_(b)}).catch(t=>{_(b),d(E,"Сохранить"),console.log(t)})},qe=e=>{e.preventDefault(),d(C,"Создание..."),le({name:me.value,link:fe.value}).then(t=>{H.prepend(O({name:t.name,link:t.link},{onPreviewPicture:K,onLikeIcon:o=>G(o,t._id),onDeleteCard:o=>R(o,t._id)})),d(C,"Создать"),_(w)}).catch(t=>{d(C,"Создать"),console.log(t)})},R=(e,t)=>{y(x),v.addEventListener("submit",o=>{o.preventDefault(),d(v.querySelector(".popup__button"),"Удаление..."),ie(t).then(n=>{_(x),e.remove(),d(v.querySelector(".popup__button"),"Да")}).catch(n=>{console.log(n),d(v.querySelector(".popup__button"),"Да")})})},G=(e,t)=>{const o=e.classList.contains("card__like-button_is-active");ae(t,o).then(n=>{n.likes.length===0?(e.classList.remove("card__like-button_is-active"),g(e.parentElement,"")):(g(e.parentElement,n.likes.length),e.classList.toggle("card__like-button_is-active"))}).catch(n=>{console.log(n)})},Le=()=>{j().then(e=>{F.innerHTML="",U.innerHTML="";let t=0,o=0,n="";const r=new Set,s={};e.forEach(c=>{r.add(c.owner._id);const i=c.likes.length;t+=i,i>o&&(o=i,n=c.name),c.likes.forEach(p=>{s[p._id]=(s[p._id]||0)+1})}),Object.keys(s).forEach(c=>{});const l=(c,i)=>{const p=pe.cloneNode(!0);p.querySelector(".popup__info-term").textContent=c,p.querySelector(".popup__info-description").textContent=i,F.append(p)};ue.textContent="Статистика карточек",l("Всего пользователей:",r.size),l("Общее количество лайков:",t),l("Максимум лайков у карточки:",o),l("Самая популярная карточка:",n);const a=[];e.forEach(c=>{if(a.length<3){a.push(c);return}let i=a[0];if(a.forEach(p=>{p.likes.length<i.likes.length&&(i=p)}),c.likes.length>i.likes.length){const p=a.indexOf(i);a[p]=c}}),a.forEach(c=>{const i=de.cloneNode(!0);i.querySelector(".popup__list-item").textContent=c.name,U.append(i)}),y(q)}).catch(e=>{console.log(e)})};S.addEventListener("submit",be);f.addEventListener("submit",qe);h.addEventListener("submit",ge);_e.addEventListener("click",Le);he.addEventListener("click",()=>{J.value=I.textContent,z.value=M.textContent,y(A),T(S,L)});$.addEventListener("click",()=>{h.reset(),y(b),T(h,L)});Se.addEventListener("click",()=>{f.reset(),y(w),T(f,L)});const Ce=document.querySelectorAll(".popup");Ce.forEach(e=>{X(e)});Promise.all([j(),ne()]).then(([e,t])=>{e.forEach(o=>{const n=O(o,{onPreviewPicture:K,onLikeIcon:r=>G(r,o._id),onDeleteCard:r=>R(r,o._id)});o.owner._id!==t._id&&n.querySelector(".card__control-button").remove(),H.append(n),o.likes.find(r=>r._id===t._id)&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),o.likes.length>0?g(n,o.likes.length):g(n,"")}),M.textContent=t.about,I.textContent=t.name,$.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
